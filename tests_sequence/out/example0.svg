<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="538" height="1089"><desc>title%20Sequence%20Diagram%0Aparticipant%20%22**this**%22%20as%20this%0Athis-%3E%3E*q%3A%2F%2Fnew%2F%2F%0Athis-%3Ewip%3Aget%0Athis-%3Ewip%3AcompareAndSet%0Agroup%20-%0Agroup%20if%20%20%5B%5B...%5D.get()%20%3D%3D%200%20%26%26%20%5B...%5D.compareAndSet(%5B...%5D)%5D%0Athis-%3Eq%3AisEmpty%0Agroup%20-%0Agroup%20if%20%20%5B%5B...%5D.isEmpty()%5D%0Athis-%3E%3Aaccept%0Athis-%3E%3Aleave%0Agroup%20if%20%20%5B%5B...%5D.leave(%5B...%5D)%20%3D%3D%200%5D%0Aaboxleft%20over%20this%3A**return**%0Aend%0Aend%0Agroup%20else%20%0Athis-%3Eq%3Aoffer%0Aend%0Aend%0Aend%0Agroup%20else%20%0Athis-%3Eq%3Aoffer%0Athis-%3E%3Aenter%0Agroup%20if%20%20%5B!%5B...%5D.enter()%5D%0Aaboxleft%20over%20this%3A**return**%0Aend%0Aend%0Aend%0Athis-%3EQueueDrainHelper%3AdrainLoop</desc><defs/><g><g/><g/><g/><g/><g/><g/><g/><g/><g/><g/><g><rect fill="white" stroke="none" x="0" y="0" width="538" height="1089"/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="16.5pt" font-style="normal" font-weight="normal" text-decoration="normal" x="175.07644852138867" y="22.6179738" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">Sequence Diagram</text></g><g/><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 88.511670804 L 128.1685182 1089.2816182079998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 220.49810718808595 161.944692408 L 220.49810718808595 1089.2816182079998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 333.587976188086 88.511670804 L 333.587976188086 1089.2816182079998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 453.48416457444927 88.511670804 L 453.48416457444927 1089.2816182079998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray="11.598960923076923,5.0262164"/></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 98.78000846399608 47.950104456000005 L 157.5570279360039 47.950104456000005 L 157.5570279360039 88.511670804 L 98.78000846399608 88.511670804 L 98.78000846399608 47.950104456000005 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="115.14034284599609" y="73.433021604" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">this</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 306.2318761200508 47.799317964000004 L 360.9440762561211 47.799317964000004 L 360.9440762561211 88.511670804 L 306.2318761200508 88.511670804 L 306.2318761200508 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="322.5922105020508" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">wip</text></g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 376.0227254561211 47.799317964000004 L 530.9456036927774 47.799317964000004 L 530.9456036927774 88.511670804 L 376.0227254561211 88.511670804 L 376.0227254561211 47.799317964000004 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="392.38305983812114" y="73.43302160400002" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">QueueDrainHelper</text></g></g><g><path fill="none" stroke="none"/><g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 200.062218912043 119.95065438599998 L 240.93399546412894 119.95065438599998 L 240.93399546412894 160.663007226 L 200.062218912043 160.663007226 L 200.062218912043 119.95065438599998 Z" stroke-miterlimit="10" stroke-width="2.4125838720000004" stroke-dasharray=""/></g><g><g/><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="216.42255329404298" y="145.584358026" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">q</text></g><g><g><rect fill="white" stroke="none" x="148.4103262419395" y="120.70458684599998" width="31.410084628164064" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="italic" font-weight="normal" text-decoration="normal" x="150.67212362193948" y="134.27537112599998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">new</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 140.306830806 L 198.177387762043 140.306830806" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(200.062218912043,140.306830806) translate(-200.062218912043,-140.306830806)"><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 187.14353178922389 134.5436946654245 L 198.64963442076655 140.306830806 L 187.14353178922389 146.06996694657548" stroke-miterlimit="10" stroke-width="1.2565541"/></g></g><g><g><rect fill="white" stroke="none" x="218.42935417195315" y="184.562666208" width="24.89778604417969" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="220.69115155195314" y="198.133450488" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">get</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 204.164910168 L 321.173221680086 204.164910168" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(333.587976188086,204.164910168) translate(-333.587976188086,-204.164910168)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 321.022435188086 197.882139668 L 333.587976188086 204.164910168 L 321.022435188086 210.447680668 Z"/></g></g><g><g><rect fill="white" stroke="none" x="176.0672097017383" y="226.782883968" width="109.62207498460937" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="178.3290070817383" y="240.353668248" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">compareAndSet</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 246.385127928 L 321.173221680086 246.385127928" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(333.587976188086,246.385127928) translate(-333.587976188086,-246.385127928)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 321.022435188086 240.102357428 L 333.587976188086 246.385127928 L 321.022435188086 252.667898428 Z"/></g></g><g><g><rect fill="white" stroke="none" x="146.01158642000001" y="350.42780740800004" width="56.64345254808594" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="148.2733838" y="363.99859168800003" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">isEmpty</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 370.03005136800004 L 208.08335268008597 370.03005136800004" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(220.49810718808595,370.03005136800004) translate(-220.49810718808595,-370.03005136800004)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 207.93256618808596 363.747280868 L 220.49810718808595 370.03005136800004 L 207.93256618808596 376.31282186800007 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 99.45706682998046 514.7850836880001 L 170.4507538500195 514.7850836880001 L 170.4507538500195 549.4659768480001 L 99.45706682998046 549.4659768480001 L 85.88628254998046 532.125530268 L 99.45706682998046 514.7850836880001" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="106.99639142998046" y="535.8951925680001" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">return</text></g><g><g><rect fill="white" stroke="none" x="157.54053234285158" y="658.032251088" width="33.585560702382814" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="159.80232972285157" y="671.603035368" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">offer</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 677.634495048 L 208.08335268008597 677.634495048" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(220.49810718808595,677.634495048) translate(-220.49810718808595,-677.634495048)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 207.93256618808596 671.351724548 L 220.49810718808595 677.634495048 L 207.93256618808596 683.9172655479999 Z"/></g></g><g><g><rect fill="white" stroke="none" x="157.54053234285158" y="808.8187430879998" width="33.585560702382814" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="159.80232972285157" y="822.3895273679998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">offer</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 828.4209870479998 L 208.08335268008597 828.4209870479998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(220.49810718808595,828.4209870479998) translate(-220.49810718808595,-828.4209870479998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 207.93256618808596 822.1382165479998 L 220.49810718808595 828.4209870479998 L 207.93256618808596 834.7037575479998 Z"/></g></g><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 99.45706682998046 891.7513136879999 L 170.4507538500195 891.7513136879999 L 170.4507538500195 926.4322068479999 L 99.45706682998046 926.4322068479999 L 85.88628254998046 909.0917602679998 L 99.45706682998046 891.7513136879999" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="bold" text-decoration="normal" x="106.99639142998046" y="912.8614225679999" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">return</text></g><g><g><rect fill="white" stroke="none" x="255.96726922695117" y="1016.9041020479998" width="69.71814432054687" height="19.602243960000003"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="11pt" font-style="normal" font-weight="normal" text-decoration="normal" x="258.22906660695116" y="1030.474886328" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">drainLoop</text></g><g><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 128.1685182 1036.5063460079998 L 441.0694100664493 1036.5063460079998" stroke-miterlimit="10" stroke-width="1.2565541" stroke-dasharray=""/><g transform="translate(453.48416457444927,1036.5063460079998) translate(-453.48416457444927,-1036.5063460079998)"><path fill="black" stroke="none" paint-order="stroke fill markers" d=" M 440.91862357444927 1030.2235755079998 L 453.48416457444927 1036.5063460079998 L 440.91862357444927 1042.7891165079998 Z"/></g></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999987 269.00310172800005 L 318.50932698808595 269.00310172800005 L 318.50932698808595 994.2861282479997 L 15.078649199999987 994.2861282479997 L 15.078649199999987 269.00310172800005 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 15.078649199999987 269.00310172800005 L 15.078649199999987 287.097480768 L 49.138382902734364 287.097480768 L 58.18557242273437 278.05029124800006 L 58.18557242273437 269.00310172800005 L 15.078649199999987 269.00310172800005" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="30.157298399999988" y="281.066021088" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">-</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 30.157298399999988 309.71545456800004 L 303.430677788086 309.71545456800004 L 303.430677788086 745.4884164479998 L 30.157298399999988 745.4884164479998 L 30.157298399999988 309.71545456800004 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 30.157298399999988 309.71545456800004 L 30.157298399999988 327.809833608 L 67.4728762189453 327.809833608 L 76.5200657389453 318.76264408800006 L 76.5200657389453 309.71545456800004 L 30.157298399999988 309.71545456800004" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="45.23594759999999" y="321.778373928" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if</text><g><rect fill="white" stroke="none" x="89.3369175589453" y="310.921746504" width="244.76369180589845" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="91.5987149389453" y="321.778373928" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[[...].get() == 0 &amp;&amp; [...].compareAndSet([...])]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 45.23594759999999 392.64802516800006 L 288.35202858808594 392.64802516800006 L 288.35202858808594 722.8704426479999 L 45.23594759999999 722.8704426479999 L 45.23594759999999 392.64802516800006 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 45.23594759999999 392.64802516800006 L 45.23594759999999 410.74240420800004 L 79.29568130273437 410.74240420800004 L 88.34287082273437 401.6952146880001 L 88.34287082273437 392.64802516800006 L 45.23594759999999 392.64802516800006" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="60.31459679999999" y="404.710944528" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">-</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 60.31459679999999 433.36037800800005 L 196.02243959999998 433.36037800800005 L 196.02243959999998 594.701924448 L 60.31459679999999 594.701924448 L 60.31459679999999 433.36037800800005 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 60.31459679999999 433.36037800800005 L 60.31459679999999 451.45475704800003 L 97.6301746189453 451.45475704800003 L 106.67736413894531 442.4075675280001 L 106.67736413894531 433.36037800800005 L 60.31459679999999 433.36037800800005" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="75.39324599999999" y="445.423297368" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if</text><g><rect fill="white" stroke="none" x="119.4942159589453" y="434.566669944" width="86.54912271410156" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="121.75601333894531" y="445.423297368" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[[...].isEmpty()]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 75.39324599999999 474.07273084800005 L 180.9437904 474.07273084800005 L 180.9437904 572.083950648 L 75.39324599999999 572.083950648 L 75.39324599999999 474.07273084800005 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 75.39324599999999 474.07273084800005 L 75.39324599999999 492.167109888 L 112.7088238189453 492.167109888 L 121.75601333894531 483.11992036800007 L 121.75601333894531 474.07273084800005 L 75.39324599999999 474.07273084800005" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="90.47189519999999" y="486.135650208" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if</text><g><rect fill="white" stroke="none" x="134.57286515894532" y="475.279022784" width="114.57570352464843" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="136.8346625389453" y="486.135650208" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[[...].leave([...]) == 0]</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 75.39324599999999 617.319898248 L 273.27337938808597 617.319898248 L 273.27337938808597 700.2524688479999 L 75.39324599999999 700.2524688479999 L 75.39324599999999 617.319898248 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 75.39324599999999 617.319898248 L 75.39324599999999 635.414277288 L 128.35861935117185 635.414277288 L 137.40580887117184 626.3670877679999 L 137.40580887117184 617.319898248 L 75.39324599999999 617.319898248" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="90.47189519999999" y="629.382817608" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">else</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 60.31459679999999 768.1063902479998 L 273.27337938808597 768.1063902479998 L 273.27337938808597 971.6681544479998 L 60.31459679999999 971.6681544479998 L 60.31459679999999 768.1063902479998 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 60.31459679999999 768.1063902479998 L 60.31459679999999 786.2007692879998 L 113.27997015117187 786.2007692879998 L 122.32715967117187 777.1535797679998 L 122.32715967117187 768.1063902479998 L 60.31459679999999 768.1063902479998" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="75.39324599999999" y="780.1693096079998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">else</text></g><g><g/><path fill="none" stroke="black" paint-order="fill stroke markers" d=" M 75.39324599999999 851.0389608479998 L 180.9437904 851.0389608479998 L 180.9437904 949.0501806479998 L 75.39324599999999 949.0501806479998 L 75.39324599999999 851.0389608479998 Z" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><path fill="white" stroke="black" paint-order="fill stroke markers" d=" M 75.39324599999999 851.0389608479998 L 75.39324599999999 869.1333398879998 L 112.7088238189453 869.1333398879998 L 121.75601333894531 860.0861503679997 L 121.75601333894531 851.0389608479998 L 75.39324599999999 851.0389608479998" stroke-miterlimit="10" stroke-width="2.154092742857143" stroke-dasharray=""/><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="90.47189519999999" y="863.1018802079998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">if</text><g><rect fill="white" stroke="none" x="134.57286515894532" y="852.2452527839998" width="73.52002420335937" height="15.681795168000004"/></g><text fill="black" stroke="none" font-family="sans-serif" font-size="8.8pt" font-style="normal" font-weight="bold" text-decoration="normal" x="136.8346625389453" y="863.1018802079998" text-anchor="start" dominant-baseline="alphabetic" xml:space="preserve">[![...].enter()]</text></g></g><g/><g/></g></svg>